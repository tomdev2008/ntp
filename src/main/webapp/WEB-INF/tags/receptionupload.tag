<%@ tag language="java" pageEncoding="UTF-8" %><%@ attribute name="fullname" type="java.lang.String" required="true" description="全路径标签名称"%><%@ attribute name="fullnameid" type="java.lang.String" required="true" description="全路径标签名称id"%><%@ attribute name="filename" type="java.lang.String" required="true" description="文件名标签名称"%><%@ attribute name="fullvalue" type="java.lang.String" required="true" description="全路径标签值"%><%@ attribute name="filevalue" type="java.lang.String" required="true" description="文件名标签值"%><%@ attribute name="id" type="java.lang.String" required="true" description="上传标签id"%><%@ attribute name="indexId" type="java.lang.String" required="true" description="上传主键id"%><%@ attribute name="folder" type="java.lang.String" required="false" description="两个选择项：System(默认,返回绝对路径), Folder(返回项目路径)"%><%@ taglib prefix="j" uri="/WEB-INF/tld/formtag.tld" %><j:set name="ctx" value="${pageContext.request.contextPath}" /><script type="text/javascript">    var count = 0;    function callMethod(method) {        method();    }    jQuery(function () {        jQuery("#${id}").uploadify({            'buttonClass' : 'btn btn-info',            'buttonText':'上传',            'multi':false,            'simUploadLimit ':1,            'height':'24px',            'width':'50px',            'swf':'${ctx}/resources/uploadify/uploadify.swf',            'uploader':'${ctx}/ajax/index/setUpload;jsessionid=${pageContext.session.id}',            'auto':true,           /*  'fileTypeExts' : '*.doc;*.docx;*.ppt;*.pptx;', */           'fileTypeExts' : '*.*;',            'onUploadProgress' : function(file, bytesUploaded, bytesTotal, totalBytesUploaded, totalBytesTotal) {            	$('#${id}').nextAll(".progress").removeClass('hide').children('.bar').width((bytesUploaded/bytesTotal)*100 + '%');            	if((bytesUploaded/bytesTotal) != 1){            		//$('#${id}').addClass('hide');            		$('#${id}').prevAll('.btn-link').hide();            		$('#${id}').nextAll('.btn-link').hide();            		$('#${id}').nextAll('button').hide();            	}            	                            },            'onUploadComplete' : function(file) {            	            },            'onUploadStart':function (file) {                jQuery("#${id}").uploadify("settings", "formData", {'folder':'${folder}','indexId':'${indexId}'});            },            'onUploadSuccess':function (file, data, Response) {                if (Response) {                	$('#${id}').nextAll(".progress").removeClass('hide').children('.bar').width("100%");                	setTimeout(hidePro,1500);                    var objvalue = eval("(" + data + ")");                    var fileName=objvalue.fileName;                    var fdPath=objvalue.fdPath;                    //alert(fdPath);                    //$('#${id}').nextAll('.btn-link').show().eq(0).attr("href",'${ctx}/'+fdPath);                    if(jQuery('#${id}')){                    	jQuery('#${id}').nextAll('.btn-link').show().eq(0).attr("href",'${ctx}/common/download/'+objvalue.attId);                    }                                        if (jQuery("#${filename}")) {                        jQuery("#${filename}").val(fileName);                    }                                        if(jQuery("#upload<%=indexId%>")){                    	jQuery("#upload<%=indexId%>").removeAttr("disabled");                    	jQuery("#upload<%=indexId%>").attr("href",'${ctx}/common/download/'+objvalue.attId);                    	jQuery("#upload<%=indexId%>").attr("style",'display: inline-block;');                    }                    if(jQuery("#${fullnameid}")){                    	 jQuery("#${fullnameid}").val(fdPath);                    }                    count++;                }            }        });        function hidePro(){        	$('#${id}').prevAll('.btn-link').show();        	$('#${id}').nextAll(".progress").addClass('hide').children('.bar').width('0%');    		$('#${id}').nextAll('.btn-link').show().eq(0).removeAttr("disabled");    		$('#${id}').nextAll('button').removeAttr("disabled").show();    		//window.parent.ifraAlert2("上传成功!");      	   $('#${id}').parent().next('.status').find("span").eq(0).text("已上传");        }    });</script><input type="file" class="" name="${id}" id="${id}" /><input type="hidden" id="${fullnameid}" name="${fullname}" value="${fullvalue}" />