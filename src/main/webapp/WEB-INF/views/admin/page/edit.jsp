<%@page pageEncoding="UTF-8"%><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%><%@ taglib prefix="j" uri="/WEB-INF/tld/formtag.tld"%><j:set name="ctx" value="${pageContext.request.contextPath}" /><!DOCTYPE html><html lang="zh_CN"><head><link rel="stylesheet"	href="${ctx}/resources/css/jquery.autocomplete.css" /><script type="text/javascript"	src="${ctx }/resources/js/jquery.autocomplete.pack.js"></script><script type="text/javascript"	src="${ctx }/resources/js/jquery.jalert.js"></script><script type="text/javascript"	src="${ctx}/resources/js/jquery.validate.min.js"></script><script type="text/javascript" src="${ctx}/resources/uploadify/jquery.uploadify.js?id=1211"></script><style type="text/css">#adduser {	background-color: #FFF;	padding: 10px 20px;}#adduser .u_list>tbody>tr a {	cursor: pointer;	text-decoration: none}#inpUser {	width: 400px;}</style><script type="text/javascript">	jQuery(document).ready(function() {		jQuery("#inputForm").validate();		//如果已经添加过的 则不能再添加(此处不进行删除后再次添加原因在于前台的顺序控制)		return;	});</script><script type="text/javascript">	$(function() {		//加普通人员信息		if ($("#teacher")[0]) {			$("#teacher").autocomplete(					"${ctx}/ajax/user/findByName",					{						matchContains : true,						max : 100,						width : 410,						dataType : 'json',						// 加入对返回的json对象进行解析的函数，函数返回一个数组						parse : function(data) {							var rows = [];							for ( var i = 0; i < data.length; i++) {								rows[rows.length] = {									data : data[i],									value : data[i].name,									result : data[i].name								// 显示在输入文本框里的内容 ,								};							}							return rows;						},						formatItem : function(item) {							var photo;							if (item.imgUrl.indexOf("http") > -1) {								photo = item.imgUrl;							} else {								photo = "${ctx}/" + item.imgUrl;							}							return '<img src="' + (photo) + '" alt="">'									+ item.name + '&nbsp;&nbsp;&nbsp;&nbsp;'									+ item.org + '&nbsp;&nbsp;'									+ item.department;						}					}).result(function(event, item) {				$("#teacher").val(item.name);				$("#fdElementId").val(item.id);			});		}		//添加学校信息		if ($("#school")[0]) {			$("#school").autocomplete("${ctx}/ajax/user/getOrg", {				matchContains : true,				max : 100,				width : 410,				dataType : 'json',				// 加入对返回的json对象进行解析的函数，函数返回一个数组				parse : function(data) {					var rows = [];					for ( var i = 0; i < data.length; i++) {						rows[rows.length] = {							data : data[i],							value : data[i].name,							result : data[i].name						// 显示在输入文本框里的内容 ,						};					}					return rows;				},				formatItem : function(item) {					return item.name;				}			}).result(function(event, item) {				$("#school").val(item.name);				$("#fdElementId").val(item.id);			});		}		//学校联盟封页		var $progress ,flag = true,pct,interval,countdown = 0,byteUped = 0;		if (!$("#school")[0])return; 		jQuery("#upPagePic").uploadify({			        'height' : 40,	                'width' : 68,	                'multi' : false,	                'simUploadLimit' : 1,	                'swf' : $('#ctx').val()+'/resources/uploadify/uploadify.swf',	                "buttonClass": "btn btn-primary btn-large",	                'buttonText' : '上 传',	                'uploader' : $('#ctx').val()+'/common/file/o_upload',	                'auto' : true,// 选中后自动上传文件	                'fileTypeExts' : '*.jpg;*.png;*.jpeg;*.BMP;',	                'fileSizeLimit':2048,// 限制文件大小为2m	                'onInit' : function(){	                	$progress = $('<span class="progress"><div class="bar" style="width:0%;"></div> </span>\	            		<span class="txt"><span class="pct">0%</span><span class="countdown"></span></span>');	                	$("#upPagePic").next(".uploadify-queue").remove();	                },	                'onUploadStart' : function (file) {	                	$("#upPagePic").before($progress);	                },	                'onUploadSuccess' : function (file, data, Response) {	                    if (Response) {	                    	$progress.find(".countdown").empty();	                    	var objvalue = eval("(" + data + ")");	                        jQuery("#attIdID").val(objvalue.attId);	                     /*  if (jQuery("#imgshow")) {	               			jQuery("#imgshow").attr('src',  $('#ctx').val()+'/common/file/image/' + objvalue.attId);	           			   } */	                       $("#imgshow").hide();	                       $(".cutimg-box").show();	                       var preImg = $('#ctx').val()+'/common/file/image/' + objvalue.attId;	                       var imgSrc = escape(preImg);	                       $("#iframeimg").attr("src",$('#ctx').val()+"/common/imageCut/page?imgSrcPath="+imgSrc+"&zoomWidth=430&zoomHeight=190&imgId="+objvalue.attId);	                    }	                },	                'onUploadProgress' : function(file, bytesUploaded, bytesTotal, totalBytesUploaded, totalBytesTotal) {	                	pct = Math.round((bytesUploaded/bytesTotal)*100)+'%';	                	byteUped = bytesUploaded;	                	if(flag){	                		interval = setInterval(uploadSpeed,100);	                		flag = false;	                	}	                	if(bytesUploaded == bytesTotal){	                		clearInterval(interval);	                			                	}	                	$progress.find(".bar").width(pct).end().find(".pct").text(pct);	                	countdown>0 && $progress.find(".countdown").text(secTransform((bytesTotal-bytesUploaded)/countdown));	                }	     });			});</script></head><body>	<div class="page-body editingBody">		<form class="form-horizontal" method="post" id="inputForm"			action="${ctx}/admin/page/savePageConfig" name="form">			<input type="hidden" name="fdType" value="${ptype}" />			<section id="set-exam" class="section">				<div class="control-group">					<label class="control-label">					<c:if test="${ptype eq '01' }">老师:</c:if> 					<c:if test="${ptype eq '02' }">学校:</c:if>					</label>					<div class="controls controls-txt">					<c:if test="${ptype eq '01' }">							<input type="text" name="teacher" id="teacher" class="span6" required								width="180px">						</c:if> <c:if test="${ptype eq '02' }">							<input type="text" name="school" id="school" class="span6" required								width="180px">						</c:if> <input type="hidden" name="fdElementId" id="fdElementId">					</div>				</div>				<div  class="control-group">					<label class="control-label">内容:</label>					<div class="controls">					<textarea rows="4"  name="fdContent" id="fdContent" class="input-block-level valid" required ></textarea>					</div>						</div>			</section>				<c:if test="${ptype eq '02' }">				<section class="section mt20">				 <label id="uploadIntro">上传图片（支持JPG\JPEG、PNG、BMP格式的图片，建议小于2M）</label>                        <div class="control-upload">                          <span class="progress">                              <div class="bar" style="width:0;"></div>                           </span>				    	  <span class="txt">				    	      <span class="pct">0%</span>，剩余时间：<span class="countdown">00:00:00</span>				    	  </span>                     						  <button id="upPagePic"class="btn btn-primary btn-large" type="button" >上传</button>						</div>												<ul class="unstyled list-attachment" id="listAttachment">						  <c:if test="${main != null}">							<li data-fdid="${main.fdId}">								<a class="name"	href="#" target="_blank">${main.fdFileName}</a>								<input type="hidden"  name="attId" id="attId" value="">								<div class="item-ctrl">									<a class="icon-remove-blue" href="#"></a>								</div>							</li>							</c:if>						 </ul>				</section>				</c:if>				<button class="btn btn-block btn-submit btn-inverse" type="submit">保存</button>		</form>	</div></body></html>