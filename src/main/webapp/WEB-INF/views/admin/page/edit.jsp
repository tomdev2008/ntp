<%@page pageEncoding="UTF-8"%><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%><%@ taglib prefix="j" uri="/WEB-INF/tld/formtag.tld"%><j:set name="ctx" value="${pageContext.request.contextPath}" /><!DOCTYPE html><html lang="zh_CN"><head><%-- <link href="${ctx}/resources/css/global.css" rel="stylesheet" type="text/css"><link href="${ctx}/resources/css/template_detail.css" rel="stylesheet" type="text/css"> --%><link rel="stylesheet" type="text/css" href="${ctx}/resources/css/jquery.autocomplete.css"><link rel="stylesheet" type="text/css" href="${ctx}/resources/kindeditor/themes/default/default.css" /></head><body>	<div class="page-body editingBody">		<form class="form-horizontal" method="post" id="inputForm"			action="${ctx}/admin/page/updatePageConfig" name="form">			<input type="hidden" name="ptype" value="${ptype}" />			<input type="hidden" name="pid" value="${pid}"/>			<section id="set-exam" class="section">				<c:if test="${ptype eq '02' }">				   <div class="section">					<label for="SchoolCover">学校封面</label> 					<input id="SchoolCover" name="SchoolCover" class="input-block-level" type="hidden"/>					<!--图片剪切-->					<div class="cutimg-box no" style="display: none;">						<iframe id="iframeimg" width="100%" height="500" id="win"							name="win" frameborder="0" scrolling="no" src=""></iframe>					</div>					<!--图片预览-->					<div class="courseCover">						<c:if test="${attId eq ''}">						<img id="imgshow" name="imgshow" style="width: 300px; height: 200px;" src="${ctx}/resources/images/zht-main-img.jpg"alt="" />						</c:if>						<c:if test="${attId ne ''}">						<img id="imgshow" name="imgshow" style="width: 300px; height: 200px;" src="${ctx}/common/file/image/${attId}" alt="" />						</c:if>					</div>				</div>				</c:if> 				<div class="control-group">					<label class="control-label"> 					<c:if test="${ptype eq '01' }">老师:</c:if> 					<c:if test="${ptype eq '02' }">学校:</c:if>					</label>					<div class="controls controls-txt">						<c:if test="${ptype eq '01' }">							<input type="text" name="teacher" id="teacher" class="span6"								required width="180px" value="${elementName}">								<label class="error" stype="display:none" for="school"></label>						</c:if>						<c:if test="${ptype eq '02' }">							<input type="text" name="school" id="school" class="span6"								required width="180px" value="${elementName}">								<label class="error" stype="display:none" for="school"></label>						</c:if>						<input type="hidden" name="fdElementId" id="fdElementId" value="${elementId}">					</div>				</div>				<div class="control-group">					<label class="control-label">内容:</label>					<div class="controls">						<textarea rows="4" name="fdContent" id="fdContent"							class="input-block-level valid" required >${content}</textarea>					</div>				</div>			</section>			<c:if test="${ptype eq '02' }">				<div class="section mt20">						<label>上传图片（支持JPG\JPEG、PNG、BMP格式的图片，建议小于2M）</label>						<div class="control-upload">                         <span class="progress"> <div class="bar" style="width:0;"></div> </span>					     <span class="txt"><span class="pct">0%</span>，剩余时间：<span class="countdown">00:00:00</span></span>						     <button id="upPagePic" class="btn btn-primary btn-large" type="button" >上传</button>							<input type="hidden"  name="attIdID" id="attIdID" value="${attId}">					</div>					</div>			</c:if>			<button class="btn btn-block btn-submit btn-inverse" type="submit">保存</button>		</form>	</div>	<script type="text/javascript" src="${ctx}/resources/js/jquery.validate.min.js"></script><script type="text/javascript" src="${ctx}/resources/js/messages_zh.js"></script><script type="text/javascript" src="${ctx}/resources/uploadify/jquery.uploadify.js?id=1211"></script><script type="text/javascript" src="${ctx}/resources/js/jquery.autocomplete.pack.js"></script><script type="text/javascript" src="${ctx}/resources/js/jquery.jalert.js" type="text/javascript"></script><script type="text/javascript" src="${ctx}/resources/js/jquery.placeholder.1.3.min.js"></script><script type="text/javascript"> 	jQuery(document).ready(function() {		jQuery("#inputForm").validate();		//如果已经添加过的 则不能再添加(此处不进行删除后再次添加原因在于前台的顺序控制)		if($('#fdElementId').val()==""){			if($("#ptype").val()=="01"){				$("#teacher").after("<label class='error'>请从下拉菜单中选择</label>");				return;			}else{				$("#school").after("<label class='error'>请从下拉菜单中选择</label>");				return;			}		}		//如果已经添加过的 则不能再添加(此处不进行删除后再次添加原因在于前台的顺序控制)		$.ajax({url: "${ctx}/ajax/page/checkUnique?fdElementId="+$('#fdElementId').val(),				async:false,				dataType:'json',				success: function(result){					if(result.ispermit){						if($("#ptype").val()=="01"){							if($.trim($("#teacher").val())!=result.name){								$("#teacher").after("<label class='error'>请从下拉菜单中选择</label>");								return;							}						}else{							if($.trim($("#school").val())!=result.name){								$("#school").after("<label class='error'>请从下拉菜单中选择</label>");								return;							}						}					}else{						if($("#ptype").val()=="01"){							$("#school").after("<label class='error'>请从下拉菜单中选择</label>");							return;						}else{							$("#teacher").after("<label class='error'>请从下拉菜单中选择</label>");							return;						}					}				}		})			}); 	$(function() {		//加普通人员信息		if ($("#teacher")[0]) {			alert('teacher');			$("#teacher").autocomplete(					"${ctx}/ajax/user/findByName",					{						matchContains : true,						max : 100,						width : 410,						dataType : 'json',						// 加入对返回的json对象进行解析的函数，函数返回一个数组						parse : function(data) {							var rows = [];							for ( var i = 0; i < data.length; i++) {								rows[rows.length] = {									data : data[i],									value : data[i].name,									result : data[i].name								// 显示在输入文本框里的内容 ,								};							}							return rows;						},						formatItem : function(item) {							var photo;							if (item.imgUrl.indexOf("http") > -1) {								photo = item.imgUrl;							} else {								photo = "${ctx}/" + item.imgUrl;							}							return '<img src="' + (photo) + '" alt="">'									+ item.name + '&nbsp;&nbsp;&nbsp;&nbsp;'									+ item.org + '&nbsp;&nbsp;'									+ item.department;						}					}).result(function(event, item) {				$("#teacher").val(item.name);				$("#fdElementId").val(item.id);			});			$("$teacher").on("change",function(){				if($(this).val()==""){					$(this).next(".error").remove();				}			})		}		//添加学校信息		if ($("#school")[0]) {			alert('school');			$("#school").autocomplete("${ctx}/ajax/user/getOrg", {				matchContains : true,				max : 100,				width : 410,				dataType : 'json',				// 加入对返回的json对象进行解析的函数，函数返回一个数组				parse : function(data) {					var rows = [];					for ( var i = 0; i < data.length; i++) {						rows[rows.length] = {							data : data[i],							value : data[i].name,							result : data[i].name						// 显示在输入文本框里的内容 ,						};					}					return rows;				},				formatItem : function(item) {					return item.name;				}			}).result(function(event, item) {				$("#school").val(item.name);				$("#fdElementId").val(item.id);			});				//学校联盟封页		var $progress, flag = true, pct, interval, countdown = 0, byteUped = 0;		if ($("#upPagePic")[0]){			 var $txt = $("#upPagePic").prev(".txt"), 			 $progress = $txt.prev(".progress").children(".bar"),			 $pct = $txt.children(".pct"),             $countdown = $txt.children(".countdown"),             flag = true,         	 pct,         	 interval,         	 countdown = 0,         	 byteUped = 0;             jQuery("#upPagePic").uploadify({             	'height' : 40,                 'width' : 68,                 'multi' : false,                 'simUploadLimit' : 1,                 'swf' : '${ctx}/resources/uploadify/uploadify.swf',                 "buttonClass": "btn btn-primary btn-large",                 'buttonText' : '上传',                 'uploader' :'${ctx}/common/file/o_upload',                 'auto' : true,                 'fileTypeExts' : '*.jpg;*.png;*.bmp;*.jpeg;',                 'onInit' : function(){                 	$("#upMaterial").next(".uploadify-queue").remove();                 },                 'onUploadStart' : function (file) {},                 'onUploadSuccess' : function (file, data, Response) {                     if (Response) {                     	$countdown.text("00:00:00");                     	$progress.width("0");                     	$pct.text("0%");                         var objvalue = eval("(" + data + ")");                         jQuery("#attIdID").val(objvalue.attId);                         jQuery("#upPagePic").val(objvalue.attId);                         $("#imgshow").hide();                         $(".cutimg-box").show();                         var preImg = '${ctx}/common/file/image/' + objvalue.attId;                         var imgSrc = escape(preImg);                         $("#iframeimg").attr("src","${ctx}/common/imageCut/page?imgSrcPath="+imgSrc+"&zoomWidth=430&zoomHeight=190&imgId="+objvalue.attId);                                            }                                     },                 'onUploadProgress' : function(file, bytesUploaded, bytesTotal, totalBytesUploaded, totalBytesTotal) {                 	 pct = Math.round((bytesUploaded/bytesTotal)*100)+'%';                 	byteUped = bytesUploaded;                 	if(flag){                 		interval = setInterval(uploadSpeed,100);                 		flag = false;                 	}                 	if(bytesUploaded == bytesTotal){                 		clearInterval(interval);                 	}                 	                 	$progress.width(pct);                 	$pct.text(pct);                 	countdown>0 && $countdown.text(secTransform((bytesTotal-bytesUploaded)/countdown*10));                  }             });             function uploadSpeed(){         		countdown = byteUped - countdown;         	}         	function secTransform(s){         		if( typeof s == "number"){         			s = Math.ceil(s);         			var t = "";         			if(s>3600){         				t= completeZero(Math.ceil(s/3600)) + ":" + completeZero(Math.ceil(s%3600/60)) + ":" + completeZero(s%3600%60) ;         			} else if(s>60){         				t= "00:" + completeZero(Math.ceil(s/60)) + ":" + completeZero(s%60) ;         			} else {         				t= "00:00:" + completeZero(s);         			}         			return t;         		}else{         			return null;         		}		         	}         	function completeZero(n){         		return n<10 ? "0"+n : n;         	}		  }		}		$("$school").on("change",function(){			if($(this).val()==""){				$(this).next(".error").remove();			}		})	});	function successSelectArea(imgSrc){        var now=new Date();        var number = now.getSeconds();        jQuery("#imgshow").attr('src',  imgSrc+"?n="+number);        $(".cutimg-box").hide();        //imgshow        $("#imgshow").show();    }</script></body></html>